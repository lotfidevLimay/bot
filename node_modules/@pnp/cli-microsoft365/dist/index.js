#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const path = require("path");
const appInsights_1 = require("./appInsights");
const Cli_1 = require("./cli/Cli");
const packageJSON = require('../package.json');
// required to make console.log() in combination with piped output synchronous
// on Windows/in PowerShell so that the output is not trimmed by calling
// process.exit() after executing the command, while the output is still
// being processed; https://github.com/pnp/cli-microsoft365/issues/1266
if (process.stdout._handle) {
    process.stdout._handle.setBlocking(true);
}
if (!process.env.CLIMICROSOFT365_NOUPDATE) {
    const updateNotifier = require('update-notifier');
    updateNotifier({ pkg: packageJSON }).notify({ defer: false });
}
fs.realpath(__dirname, (err, resolvedPath) => {
    try {
        const cli = Cli_1.Cli.getInstance();
        cli.execute(path.join(resolvedPath, 'm365'), process.argv.slice(2));
    }
    catch (e) {
        appInsights_1.default.trackException({
            exception: e
        });
        appInsights_1.default.flush();
        process.exit(1);
    }
});
//# sourceMappingURL=index.js.map